

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Agents with RAG &#8212; CAMEL 0.1.5.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials_and_cookbooks/agents_with_rag';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="camel" href="../modules.html" />
    <link rel="prev" title="Retrievers" href="../key_modules/retrievers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">CAMEL 0.1.5.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../get_started/setup.html">Installation and Setup</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Agents</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../agents/single_agent.html">Creating Your First Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/role_playing.html">Creating Your First Agent Society</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/embodied_agents.html">Embodied Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../agents/critic_agents_and_tree_search.html">Critic Agents and Tree Search</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Key Modules</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../key_modules/loaders.html">Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_modules/storages.html">Storages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_modules/embeddings.html">Embeddings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../key_modules/retrievers.html">Retrievers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorial and Cookbooks</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Agents with RAG</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../modules.html">camel</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../camel.html">Camel Package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../camel.agents.html">camel.agents package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../camel.prompts.html">camel.prompts package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorials_and_cookbooks/agents_with_rag.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Agents with RAG</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#philosophical-bits">Philosophical Bits</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customized-rag">1. Customized RAG</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-rag">2. Auto RAG</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-agent-with-auto-rag">3. Single Agent with Auto RAG</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#role-playing-with-auto-rag">4. Role-playing with Auto RAG</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="agents-with-rag">
<h1>Agents with RAG<a class="headerlink" href="#agents-with-rag" title="Permalink to this heading">#</a></h1>
<section id="philosophical-bits">
<h2>Philosophical Bits<a class="headerlink" href="#philosophical-bits" title="Permalink to this heading">#</a></h2>
<p><a class="reference external" href="https://colab.research.google.com/drive/1sTJ0x_MYRGA76KCg_3I00wj4RL3D2Twp?usp=sharing"><img alt="Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>In this notebook, we show the useage of CAMEL Retrieve Module in both customized way and auto way. We will also show how to combine <code class="docutils literal notranslate"><span class="pre">AutoRetriever</span></code> with <code class="docutils literal notranslate"><span class="pre">ChatAgent</span></code>, and further combine <code class="docutils literal notranslate"><span class="pre">AutoRetriever</span></code> with <code class="docutils literal notranslate"><span class="pre">RolePlaying</span></code> by using <code class="docutils literal notranslate"><span class="pre">Function</span> <span class="pre">Calling</span></code>.</p>
<p>4 main parts included:</p>
<ul class="simple">
<li><p>Customized RAG</p></li>
<li><p>Auto RAG</p></li>
<li><p>Single Agent with Auto RAG</p></li>
<li><p>Role-playing with Auto RAG</p></li>
</ul>
</section>
<section id="load-data">
<h2>Load Data<a class="headerlink" href="#load-data" title="Permalink to this heading">#</a></h2>
<p>Let’s first load the CAMEL paper from https://arxiv.org/pdf/2303.17760.pdf. This will be our local example data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;local_data&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://arxiv.org/pdf/2303.17760.pdf&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;local_data/camel paper.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
     <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="customized-rag">
<h2>1. Customized RAG<a class="headerlink" href="#customized-rag" title="Permalink to this heading">#</a></h2>
<p>In this section we will set our customized RAG pipeline, we will take <code class="docutils literal notranslate"><span class="pre">VectorRetriever</span></code> as an example.
Set embedding model, we will use <code class="docutils literal notranslate"><span class="pre">OpenAIEmbedding</span></code> as the embedding model, so we need to set the <code class="docutils literal notranslate"><span class="pre">OPENAI_API_KEY</span></code> in below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENAI_API_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Your Key&quot;</span>
</pre></div>
</div>
<p>Import and set the embedding instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">camel.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbedding</span>

<span class="n">embedding_instance</span> <span class="o">=</span> <span class="n">OpenAIEmbedding</span><span class="p">()</span>
</pre></div>
</div>
<p>Import and set the vector storage instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">camel.storages</span> <span class="kn">import</span> <span class="n">MilvusStorage</span>

<span class="n">storage_instance</span> <span class="o">=</span> <span class="n">MilvusStorage</span><span class="p">(</span>
    <span class="n">vector_dim</span><span class="o">=</span><span class="n">embedding_instance</span><span class="o">.</span><span class="n">get_output_dim</span><span class="p">(),</span>
    <span class="n">url_and_api_key</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Your Milvus URI&quot;</span><span class="p">,</span><span class="s2">&quot;Your Milvus Token&quot;</span><span class="p">),</span>
    <span class="n">collection_name</span><span class="o">=</span><span class="s2">&quot;camel_paper&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Import and set the retriever instance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">camel.retrievers</span> <span class="kn">import</span> <span class="n">VectorRetriever</span>

<span class="n">vector_retriever</span> <span class="o">=</span> <span class="n">VectorRetriever</span><span class="p">(</span><span class="n">embedding_model</span><span class="o">=</span><span class="n">embedding_instance</span><span class="p">)</span>
</pre></div>
</div>
<p>We use integrated <code class="docutils literal notranslate"><span class="pre">Unstructured</span> <span class="pre">Module</span></code> to splite the content into small chunks, the content will be splited automacitlly with its <code class="docutils literal notranslate"><span class="pre">chunk_by_title</span></code> function, the max character for each chunk is 500 characters, which is a suitable length for <code class="docutils literal notranslate"><span class="pre">OpenAIEmbedding</span></code>. All the text in the chunks will be embed and stored to the vector storage instance, it will take some time, please wait..</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vector_retriever</span><span class="o">.</span><span class="n">process</span><span class="p">(</span>
    <span class="n">content_input_path</span><span class="o">=</span><span class="s2">&quot;local_data/camel paper.pdf&quot;</span><span class="p">,</span>
    <span class="n">storage</span><span class="o">=</span><span class="n">storage_instance</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now we can retrieve information from the vector storage by giving a query. By default it will give you back the text content from top 1 chunk with highest Cosine similarity score, and the similarity score should be higher than 0.75 to ensure the retrieved content is relevant to the query. You can also change the <code class="docutils literal notranslate"><span class="pre">top_k</span></code> value and <code class="docutils literal notranslate"><span class="pre">similarity_threshold</span></code> value with your needs.</p>
<p>The returned string list includes:</p>
<ul class="simple">
<li><p>similarity score</p></li>
<li><p>content path</p></li>
<li><p>metadata</p></li>
<li><p>text</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">retrieved_info</span> <span class="o">=</span> <span class="n">vector_retriever</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;What is CAMEL?&quot;</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="n">storage_instance</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">retrieved_info</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; [{&#39;similarity score&#39;: &#39;0.8321741223335266&#39;, &#39;content path&#39;: &#39;local_data/camel paper.pdf&#39;, &#39;metadata&#39;: {&#39;filetype&#39;: &#39;application/pdf&#39;, &#39;languages&#39;: [&#39;eng&#39;], &#39;last_modified&#39;: &#39;2024-03-24T17:58:24&#39;, &#39;page_number&#39;: 45}, &#39;text&#39;: &#39;CAMEL Data and Code License The intended purpose and licensing of CAMEL is solely for research use. The source code is licensed under Apache 2.0. The datasets are licensed under CC BY NC 4.0, which permits only non-commercial usage. It is advised that any models trained using the dataset should not be utilized for anything other than research purposes.\n\n45&#39;}]
</pre></div>
</div>
<p>Let’s try an irrelevant query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">retrieved_info_irrevelant</span> <span class="o">=</span> <span class="n">vector_retriever</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;Compared with dumpling and rice, which should I take for dinner?&quot;</span><span class="p">,</span>
    <span class="n">storage</span><span class="o">=</span><span class="n">storage_instance</span><span class="p">,</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">retrieved_info_irrevelant</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; [{&#39;text&#39;: &#39;No suitable information retrieved from local_data/camel paper.pdf                 with similarity_threshold = 0.75.&#39;}]
</pre></div>
</div>
</section>
<section id="auto-rag">
<h2>2. Auto RAG<a class="headerlink" href="#auto-rag" title="Permalink to this heading">#</a></h2>
<p>In this section we will run the <code class="docutils literal notranslate"><span class="pre">AutoRetriever</span></code> with default settings. It uses <code class="docutils literal notranslate"><span class="pre">OpenAIEmbedding</span></code> as default embedding model and <code class="docutils literal notranslate"><span class="pre">Milvus</span></code> as default vector storage.</p>
<p>What you need to do is:</p>
<ul class="simple">
<li><p>Set content input paths, which can be local paths or remote urls</p></li>
<li><p>Set remote url and api key for Milvus</p></li>
<li><p>Give a query</p></li>
</ul>
<p>The Auto RAG pipeline would create collections for given content input paths, the collection name will be set automaticlly based on the content input path name, if the collection exists, it will do the retrieve directly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">camel.retrievers</span> <span class="kn">import</span> <span class="n">AutoRetriever</span>
<span class="kn">from</span> <span class="nn">camel.types</span> <span class="kn">import</span> <span class="n">StorageType</span>

<span class="n">auto_retriever</span> <span class="o">=</span> <span class="n">AutoRetriever</span><span class="p">(</span>
        <span class="n">url_and_api_key</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Your Milvus URI&quot;</span><span class="p">,</span><span class="s2">&quot;Your Milvus Token&quot;</span><span class="p">),</span>
        <span class="n">storage_type</span><span class="o">=</span><span class="n">StorageType</span><span class="o">.</span><span class="n">MILVUS</span><span class="p">,</span>
        <span class="n">embedding_model</span><span class="o">=</span><span class="n">embedding_instance</span><span class="p">)</span>

<span class="n">retrieved_info</span> <span class="o">=</span> <span class="n">auto_retriever</span><span class="o">.</span><span class="n">run_vector_retriever</span><span class="p">(</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;What is CAMEL-AI&quot;</span><span class="p">,</span>
    <span class="n">content_input_paths</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;local_data/camel paper.pdf&quot;</span><span class="p">,</span>  <span class="c1"># example local path</span>
        <span class="s2">&quot;https://www.camel-ai.org/&quot;</span><span class="p">,</span>  <span class="c1"># example remote url</span>
    <span class="p">],</span>
    <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">return_detailed_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">retrieved_info</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; Original Query:
{What is CAMEL-AI}
Retrieved Context:
{&#39;similarity score&#39;: &#39;0.8369356393814087&#39;, &#39;content path&#39;: &#39;local_data/camel paper.pdf&#39;, &#39;metadata&#39;: {&#39;filetype&#39;: &#39;application/pdf&#39;, &#39;languages&#39;: [&#39;eng&#39;], &#39;last_modified&#39;: &#39;2024-03-24T17:58:24&#39;, &#39;page_number&#39;: 7}, &#39;text&#39;: &#39;Section 3.2, to simulate assistant-user cooperation. For our analysis, we set our attention on AI Society setting. We also gathered conversational data, named CAMEL AI Society and CAMEL Code datasets and problem-solution pairs data named CAMEL Math and CAMEL Science and analyzed and evaluated their quality. Moreover, we will discuss potential extensions of our framework and highlight both the risks and opportunities that future AI society might present.&#39;}
{&#39;similarity score&#39;: &#39;0.8378663659095764&#39;, &#39;content path&#39;: &#39;https://www.camel-ai.org/&#39;, &#39;metadata&#39;: {&#39;emphasized_text_contents&#39;: [&#39;Mission&#39;, &#39;CAMEL-AI.org&#39;, &#39;is an open-source community dedicated to the study of autonomous and communicative agents. We believe that studying these agents on a large scale offers valuable insights into their behaviors, capabilities, and potential risks. To facilitate research in this field, we provide, implement, and support various types of agents, tasks, prompts, models, datasets, and simulated environments.&#39;, &#39;Join us via&#39;, &#39;Slack&#39;, &#39;Discord&#39;, &#39;or&#39;], &#39;emphasized_text_tags&#39;: [&#39;span&#39;, &#39;span&#39;, &#39;span&#39;, &#39;span&#39;, &#39;span&#39;, &#39;span&#39;, &#39;span&#39;], &#39;filetype&#39;: &#39;text/html&#39;, &#39;languages&#39;: [&#39;eng&#39;], &#39;link_texts&#39;: [None, None, None], &#39;link_urls&#39;: [&#39;#h.3f4tphhd9pn8&#39;, &#39;https://join.slack.com/t/camel-ai/shared_invite/zt-1vy8u9lbo-ZQmhIAyWSEfSwLCl2r2eKA&#39;, &#39;https://discord.gg/CNcNpquyDc&#39;], &#39;page_number&#39;: 1, &#39;url&#39;: &#39;https://www.camel-ai.org/&#39;}, &#39;text&#39;: &#39;Mission\n\nCAMEL-AI.org is an open-source community dedicated to the study of autonomous and communicative agents. We believe that studying these agents on a large scale offers valuable insights into their behaviors, capabilities, and potential risks. To facilitate research in this field, we provide, implement, and support various types of agents, tasks, prompts, models, datasets, and simulated environments.\n\nJoin us via\n\nSlack\n\nDiscord\n\nor&#39;}
</pre></div>
</div>
</section>
<section id="single-agent-with-auto-rag">
<h2>3. Single Agent with Auto RAG<a class="headerlink" href="#single-agent-with-auto-rag" title="Permalink to this heading">#</a></h2>
<p>In this section we will show how to combine the <code class="docutils literal notranslate"><span class="pre">AutoRetriever</span></code> with one <code class="docutils literal notranslate"><span class="pre">ChatAgent</span></code>.</p>
<p>Let’s set an agent function, in this function we can get the response by providing a query to this agent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">camel.agents</span> <span class="kn">import</span> <span class="n">ChatAgent</span>
<span class="kn">from</span> <span class="nn">camel.messages</span> <span class="kn">import</span> <span class="n">BaseMessage</span>
<span class="kn">from</span> <span class="nn">camel.types</span> <span class="kn">import</span> <span class="n">RoleType</span>
<span class="kn">from</span> <span class="nn">camel.retrievers</span> <span class="kn">import</span> <span class="n">AutoRetriever</span>
<span class="kn">from</span> <span class="nn">camel.types</span> <span class="kn">import</span> <span class="n">StorageType</span>

<span class="k">def</span> <span class="nf">single_agent</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span><span class="nb">str</span> <span class="p">:</span>
    <span class="c1"># Set agent role</span>
    <span class="n">assistant_sys_msg</span> <span class="o">=</span> <span class="n">BaseMessage</span><span class="p">(</span>
        <span class="n">role_name</span><span class="o">=</span><span class="s2">&quot;Assistant&quot;</span><span class="p">,</span>
        <span class="n">role_type</span><span class="o">=</span><span class="n">RoleType</span><span class="o">.</span><span class="n">ASSISTANT</span><span class="p">,</span>
        <span class="n">meta_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">content</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant to answer question, I will give you the Original Query and Retrieved Context, answer the Original Query based on the Retrieved Context, if you can&#39;t answer the question just say I don&#39;t know.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add auto retriever</span>
    <span class="n">auto_retriever</span> <span class="o">=</span> <span class="n">AutoRetriever</span><span class="p">(</span>
            <span class="n">url_and_api_key</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Your Milvus URI&quot;</span><span class="p">,</span><span class="s2">&quot;Your Milvus Token&quot;</span><span class="p">),</span>
            <span class="n">storage_type</span><span class="o">=</span><span class="n">StorageType</span><span class="o">.</span><span class="n">MILVUS</span><span class="p">,</span>
            <span class="n">embedding_model</span><span class="o">=</span><span class="n">embedding_instance</span><span class="p">)</span>

    <span class="n">retrieved_info</span> <span class="o">=</span> <span class="n">auto_retriever</span><span class="o">.</span><span class="n">run_vector_retriever</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
        <span class="n">content_input_paths</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;local_data/camel paper.pdf&quot;</span><span class="p">,</span>  <span class="c1"># example local path</span>
            <span class="s2">&quot;https://www.camel-ai.org/&quot;</span><span class="p">,</span>  <span class="c1"># example remote url</span>
        <span class="p">],</span>
        <span class="c1"># vector_storage_local_path=&quot;storage_default_run&quot;,</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">return_detailed_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Pass the retrieved infomation to agent</span>
    <span class="n">user_msg</span> <span class="o">=</span> <span class="n">BaseMessage</span><span class="o">.</span><span class="n">make_user_message</span><span class="p">(</span><span class="n">role_name</span><span class="o">=</span><span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">retrieved_info</span><span class="p">)</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="n">ChatAgent</span><span class="p">(</span><span class="n">assistant_sys_msg</span><span class="p">)</span>

    <span class="c1"># Get response</span>
    <span class="n">assistant_response</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">user_msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">assistant_response</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span>

<span class="nb">print</span><span class="p">(</span><span class="n">single_agent</span><span class="p">(</span><span class="s2">&quot;What is CAMEL-AI&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; CAMEL-AI is an open-source community dedicated to the study of autonomous and communicative agents. It provides, implements, and supports various types of agents, tasks, prompts, models, datasets, and simulated environments to facilitate research in this field.
</pre></div>
</div>
</section>
<section id="role-playing-with-auto-rag">
<h2>4. Role-playing with Auto RAG<a class="headerlink" href="#role-playing-with-auto-rag" title="Permalink to this heading">#</a></h2>
<p>In this section we will show how to combine the <code class="docutils literal notranslate"><span class="pre">AutoRetriever</span></code> with <code class="docutils literal notranslate"><span class="pre">RolePlaying</span></code> by applying <code class="docutils literal notranslate"><span class="pre">Function</span> <span class="pre">Calling</span></code>.</p>
<p>First, we need to set a retriever function with well-written docstring for LLM to understand what this function is used for, the main code is the same with the Auto RAG section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">camel.functions</span> <span class="kn">import</span> <span class="n">OpenAIFunction</span>
<span class="kn">from</span> <span class="nn">camel.retrievers</span> <span class="kn">import</span> <span class="n">AutoRetriever</span>
<span class="kn">from</span> <span class="nn">camel.types</span> <span class="kn">import</span> <span class="n">StorageType</span>

<span class="k">def</span> <span class="nf">local_retriever</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Performs an auto local retriever for information. Given a query,</span>
<span class="sd">    this function will retrieve the information from the local vector storage,</span>
<span class="sd">    and return the retrieved information back. It is useful for information</span>
<span class="sd">    retrieve.</span>

<span class="sd">    Args:</span>
<span class="sd">        query (string): Question you want to be answered.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Aggregated information retrieved in response to the query.</span>

<span class="sd">    Example:</span>
<span class="sd">        local_retriever(query = &quot;what is camel?&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">auto_retriever</span> <span class="o">=</span> <span class="n">AutoRetriever</span><span class="p">(</span>
            <span class="n">url_and_api_key</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Your Milvus URI&quot;</span><span class="p">,</span><span class="s2">&quot;Your Milvus Token&quot;</span><span class="p">),</span>
            <span class="n">storage_type</span><span class="o">=</span><span class="n">StorageType</span><span class="o">.</span><span class="n">MILVUS</span><span class="p">,</span>
            <span class="n">embedding_model</span><span class="o">=</span><span class="n">embedding_instance</span><span class="p">)</span>

    <span class="n">retrieved_info</span> <span class="o">=</span> <span class="n">auto_retriever</span><span class="o">.</span><span class="n">run_vector_retriever</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
        <span class="n">content_input_paths</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;local_data/camel paper.pdf&quot;</span><span class="p">,</span>  <span class="c1"># example local path</span>
        <span class="p">],</span>
        <span class="n">top_k</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">retrieved_info</span>

<span class="c1"># add the function to OpenAIFunction list</span>
<span class="n">RETRIEVER_FUNCS</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OpenAIFunction</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">OpenAIFunction</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">local_retriever</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Run the role-playing with defined retriever function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">camel.utils</span> <span class="kn">import</span> <span class="n">role_playing_with_function</span>
<span class="kn">from</span> <span class="nn">camel.functions</span> <span class="kn">import</span> <span class="n">MATH_FUNCS</span>  <span class="c1"># import another function from camel</span>

<span class="n">role_playing_with_function</span><span class="p">(</span>
    <span class="n">task_prompt</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;What is the main termination reasons for AI Society dataset, how many number of messages did camel decided to limit, what&#39;s the value plus 100?&quot;</span>
    <span class="p">),</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">RETRIEVER_FUNCS</span><span class="p">,</span> <span class="o">*</span><span class="n">MATH_FUNCS</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; 
AI Assistant sys message:
BaseMessage(role_name=&#39;Searcher&#39;, role_type=&lt;RoleType.ASSISTANT: &#39;assistant&#39;&gt;, meta_dict={&#39;task&#39;: &quot;What is the main termination reasons for AI Society dataset, how many number of messages did camel decided to limit, what&#39;s the value plus 100?&quot;, &#39;assistant_role&#39;: &#39;Searcher&#39;, &#39;user_role&#39;: &#39;Professor&#39;}, content=&quot;===== RULES OF ASSISTANT =====\nNever forget you are a Searcher and I am a Professor. Never flip roles! Never instruct me!\nWe share a common interest in collaborating to successfully complete a task.\nYou must help me to complete the task.\nHere is the task: What is the main termination reasons for AI Society dataset, how many number of messages did camel decided to limit, what&#39;s the value plus 100?. Never forget our task!\nI must instruct you based on your expertise and my needs to complete the task.\n\nI must give you one instruction at a time.\nYou must write a specific solution that appropriately solves the requested instruction and explain your solutions.\nYou must decline my instruction honestly if you cannot perform the instruction due to physical, moral, legal reasons or your capability and explain the reasons.\nUnless I say the task is completed, you should always start with:\n\nSolution: &lt;YOUR_SOLUTION&gt;\n\n&lt;YOUR_SOLUTION&gt; should be very specific, include detailed explanations and provide preferable detailed implementations and examples and lists for task-solving.\nAlways end &lt;YOUR_SOLUTION&gt; with: Next request.&quot;)

AI User sys message:
BaseMessage(role_name=&#39;Professor&#39;, role_type=&lt;RoleType.USER: &#39;user&#39;&gt;, meta_dict={&#39;task&#39;: &quot;What is the main termination reasons for AI Society dataset, how many number of messages did camel decided to limit, what&#39;s the value plus 100?&quot;, &#39;assistant_role&#39;: &#39;Searcher&#39;, &#39;user_role&#39;: &#39;Professor&#39;}, content=&#39;===== RULES OF USER =====\nNever forget you are a Professor and I am a Searcher. Never flip roles! You will always instruct me.\nWe share a common interest in collaborating to successfully complete a task.\nI must help you to complete the task.\nHere is the task: What is the main termination reasons for AI Society dataset, how many number of messages did camel decided to limit, what\&#39;s the value plus 100?. Never forget our task!\nYou must instruct me based on my expertise and your needs to solve the task ONLY in the following two ways:\n\n1. Instruct with a necessary input:\nInstruction: &lt;YOUR_INSTRUCTION&gt;\nInput: &lt;YOUR_INPUT&gt;\n\n2. Instruct without any input:\nInstruction: &lt;YOUR_INSTRUCTION&gt;\nInput: None\n\nThe &quot;Instruction&quot; describes a task or question. The paired &quot;Input&quot; provides further context or information for the requested &quot;Instruction&quot;.\n\nYou must give me one instruction at a time.\nI must write a response that appropriately solves the requested instruction.\nI must decline your instruction honestly if I cannot perform the instruction due to physical, moral, legal reasons or my capability and explain the reasons.\nYou should instruct me not ask me questions.\nNow you must start to instruct me using the two ways described above.\nDo not add anything else other than your instruction and the optional corresponding input!\nKeep giving me instructions and necessary inputs until you think the task is completed.\nWhen the task is completed, you must only reply with a single word &lt;CAMEL_TASK_DONE&gt;.\nNever say &lt;CAMEL_TASK_DONE&gt; unless my responses have solved your task.&#39;)

Original task prompt:
What is the main termination reasons for AI Society dataset, how many number of messages did camel decided to limit, what&#39;s the value plus 100?

Specified task prompt:
None

Final task prompt:
What is the main termination reasons for AI Society dataset, how many number of messages did camel decided to limit, what&#39;s the value plus 100?

AI User:

Instruction: Provide the main termination reasons from the AI Society dataset.
Input: None


AI Assistant:

Function Execution: local_retriever
	Args: {&#39;query&#39;: &#39;main termination reasons for AI Society dataset&#39;}
	Result: Original Query:
{main termination reasons for AI Society dataset}
Retrieved Context:
Next we examine the conversation termination reasons for both AI Society and Code datasets. As can be seen in Figure 8, the main termination reasons for AI Society dataset is Assistant Instruct whereas for Code it is Token Limit. The latter is expected as the since responses that contain code tend to be long. It is also interesting to note that in both datasets, the termination due to Maximum Number of Messages is low indicating that the limit of 40 maximum messages is reasonable. Our decision

Solution: The main termination reason for the AI Society dataset is &quot;Assistant Instruct.&quot; This indicates that the conversations in this dataset typically end when the assistant is instructed to terminate the conversation.

Next request.


AI User:

Instruction: Identify the number of messages that camel decided to limit.
Input: None


AI Assistant:

Function Execution: local_retriever
	Args: {&#39;query&#39;: &#39;number of messages camel decided to limit&#39;}
	Result: Original Query:
{number of messages camel decided to limit}
Retrieved Context:
to limit the number of messages to 40 is also cost-related. Even if we provide a set of termination conditions, we still want to put a safeguard to the maximum limit of the message. It is because after the task is completed the agents will provide short outputs like &quot;thank you&quot; and &quot;welcome&quot;. If no safeguard is set and termination fails, the conversation will only end until it exceeds the token limit, which may end up with thousands of API calls and hundreds of USD dollars cost.

Solution: Camel decided to limit the number of messages to 40 as a safeguard to prevent excessive API calls and associated costs.

Next request.


AI User:

Instruction: Calculate the value of the message limit plus 100.
Input: None


AI Assistant:

Function Execution: add
	Args: {&#39;a&#39;: 40, &#39;b&#39;: 100}
	Result: 140

Solution: The value of the message limit plus 100 is 140.

Next request.


AI User:

CAMEL_TASK_DONE


AI Assistant:

Solution: Understood, the task is completed.

If you have any more tasks or need further assistance, feel free to provide new instructions.
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../key_modules/retrievers.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Retrievers</p>
      </div>
    </a>
    <a class="right-next"
       href="../modules.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">camel</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#philosophical-bits">Philosophical Bits</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customized-rag">1. Customized RAG</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-rag">2. Auto RAG</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-agent-with-auto-rag">3. Single Agent with Auto RAG</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#role-playing-with-auto-rag">4. Role-playing with Auto RAG</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By CAMEL-AI.org
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023, CAMEL-AI.org.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>